<!--expected_contribution_edit.html-->

<!DOCTYPE html>
<html lang="cs" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Editace OÄekÃ¡vanÃ½ch PÅ™Ã­spÄ›vkÅ¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">

<!-- ModÃ¡lnÃ­ okno -->
<div class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded-lg shadow-lg w-96">
        <h2 class="text-xl font-semibold mb-4">ğŸ’° Editace OÄekÃ¡vanÃ½ch PÅ™Ã­spÄ›vkÅ¯</h2>

        <!-- FormulÃ¡Å™ pro pÅ™idÃ¡nÃ­ novÃ© poloÅ¾ky -->
        <form id="expectedContributionForm">
            <input type="hidden" id="expectedContributionExpenseId" name="expenseId" th:value="${expenseId}">
            <input type="number" id="expectedContributionAmount" name="amount" placeholder="ÄŒÃ¡stka" required class="border p-2 w-full">
            <button type="button" onclick="addExpectedContribution()" class="bg-blue-600 text-white px-4 py-2 rounded mt-4">â• PÅ™idat</button>
        </form>


        <hr class="my-4">

        <!-- Seznam pÅ™Ã­spÄ›vkÅ¯ -->
        <h3 class="text-lg font-semibold">ğŸ“‹ Seznam pÅ™Ã­spÄ›vkÅ¯</h3>
        <table class="table-auto w-full border-collapse border">
            <thead>
            <tr>
                <th>#</th>
                <th>ÄŒÃ¡stka</th>
                <th>ğŸ—‘ï¸</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="entry : ${expectedContributions}">
                <td th:text="${entry.itemNumber}"></td>
                <td th:text="${entry.amount}"></td>
                <td>
                    <button th:attr="data-entry-id=${entry.id}, data-expense-id=${expenseId}"
                            onclick="removeExpectedContribution(this)"
                            class="bg-red-600 text-white px-3 py-1 rounded">ğŸ—‘ï¸ Odebrat
                    </button>
                </td>
            </tr>
            </tbody>
        </table>

        <button onclick="closeModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded w-full">ZavÅ™Ã­t</button>
    </div>
</div>

<script>
    function addExpectedContribution() {
        let expenseId = document.getElementById("expectedContributionExpenseId").value;
        let amount = document.getElementById("expectedContributionAmount").value;

        fetch("/expenses/expected_contribution/add", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `expenseId=${expenseId}&amount=${amount}`
        })
            .then(response => {
                if (response.ok) {
                    location.reload(); // âœ… Opraveno, mÃ­sto pÅ™epsÃ¡nÃ­ celÃ© strÃ¡nky se jen znovu naÄte
                } else {
                    alert("Chyba pÅ™i pÅ™idÃ¡vÃ¡nÃ­ pÅ™Ã­spÄ›vku.");
                }
            });
    }


    function removeExpectedContribution(button) {
        let entryId = button.getAttribute("data-entry-id");
        let expenseId = button.getAttribute("data-expense-id");

        fetch("/expenses/expected_contribution/remove", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: `entryId=${entryId}&expenseId=${expenseId}`
        })
            .then(response => {
                if (response.ok) {
                    location.reload(); // âœ… ZÅ¯stane v modÃ¡lnÃ­m oknÄ› a obnovÃ­ seznam
                } else {
                    alert("Chyba pÅ™i odebÃ­rÃ¡nÃ­ pÅ™Ã­spÄ›vku.");
                }
            });
    }

    function closeModal() {
        window.history.back();
    }
</script>

</body>
</html>
